function parameter_value(a,b){var c=new RegExp(b+"=([^&]*)","i").exec(a);return c&&unescape(c[1])||""}var mutual_friends,bmf_ajax_request=null;!function(a){mutual_friends={init:function(){mutual_friends.init_maginific_popup(),a("body").on("click","a.mutual-friends",mutual_friends.fetch_mutual_friend),a("body").on("click",".friendship-button a",mutual_friends.add_remove_friendship),a(document).ajaxComplete(mutual_friends.rebind_magnific_popup),a("body").on("click","a.bmf-load-more",mutual_friends.member_loop_next_page)},fetch_mutual_friend:function(b){jqelement=a(this),b.preventDefault(),a("div.bmf-white-popup").html('<div class="bmf-spinner"></div>');var c=jqelement.data("user-id"),d={action:"mutual_friends_dialog",user_id:c};a.post(ajaxurl,d,function(b){a("div.bmf-white-popup").find("div.bmf-spinner").remove(),a("div.bmf-white-popup").append('<button title="Close (Esc)" type="button" class="mfp-close">Ã—</button>'+b),a("div.bmf-white-popup").perfectScrollbar()})},init_maginific_popup:function(){a("a.mutual-friends").magnificPopup({items:{src:a('<div id="buddypress" class="bmf-white-popup"></div>'),type:"inline"},showCloseBtn:!0,closeBtnInside:!0})},rebind_magnific_popup:function(b,c,d){if(null!=bmf_ajax_request)return bmf_ajax_request=null,!1;var e=d.data,f=parameter_value(e,"action");if("members_filter"==f)var g=setTimeout(function(){return jqelement=a("#buddypress").find("a.mutual-friends"),"undefined"!=typeof jqelement?(mutual_friends.init_maginific_popup(),clearInterval(g),!1):void 0},1e3)},add_remove_friendship:function(){a(this).parent().addClass("loading");var b=a(this).attr("id"),c=a(this).attr("href"),d=a(this);return b=b.split("-"),b=b[1],c=c.split("?_wpnonce="),c=c[1].split("&"),c=c[0],a.post(ajaxurl,{action:"addremove_friend",cookie:bp_get_cookies(),fid:b,_wpnonce:c},function(b){var c=d.attr("rel");parentdiv=d.parent(),"add"===c?a(parentdiv).fadeOut(200,function(){parentdiv.removeClass("add_friend"),parentdiv.removeClass("loading"),parentdiv.addClass("pending_friend"),parentdiv.fadeIn(200).html(b)}):"remove"===c&&a(parentdiv).fadeOut(200,function(){parentdiv.removeClass("remove_friend"),parentdiv.removeClass("loading"),parentdiv.addClass("add"),parentdiv.fadeIn(200).html(b)})}),!1},member_loop_next_page:function(b){jqelement=a(this).parent(),jqparent_element=jqelement.parent(),b.preventDefault();var c=parseInt(jqelement.data("next-page-no")),d=parseInt(jqelement.data("total-page-count"));c>d?a("ul.activity-list").hide():(jqparent_element.addClass("loading"),bmf_ajax_request=a.post(ajaxurl,{action:"members_filter",cookie:bp_get_cookies(),object:"members",search_terms:"",page:2,template:""},function(b){jqparent_element.removeClass("loading");var c=a(b).find("li");a("#members-list").append(c)})),jqelement.data("next-page-no",c+1)}},a(document).ready(function(){mutual_friends.init()})}(jQuery);